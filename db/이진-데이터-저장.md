관계형 데이터베이스에 상대적으로 크기가 큰 이진 데이터를 직접 저장하면 어떨까? 한번쯤 생각해봤다. 하지만 일반적으로 이미지, 오디오와 같은 이진 데이터는 데이터베이스에 직접 저장하지 않고 별도의 스토리지(하드디스크, 클라우드 등)에 저장하지 않는 것으로 알아왔다. 그렇다면 이러한 이유에 대해 알아보자.

## 왜 파일 시스템에 저장해야하는가?

- 데이터베이스에 대한 이진 데이터의 읽기/쓰기는 일반적으로 파일 시스템보다 느리다.
- 이진 데이터의 크기가 너무 커서 데이터베이스 백업을 위한 복제 및 복구 속도가 너무 느려진다.
- 파일에 접근하기 위해 애플리케이션 및 데이터베이스 계층을 거쳐야한다.
  - 메모리 요구 사항이 증가
  - 만약 파일 시스템을 이용한다면, 웹 서버 계층 수준에서 전달가능
- 가벼운 웹 서버, CDN, AWS S3 등이 더 효율적
- 같은 데이터를 파일 서버에 저장하는 것이 비용 효율성이 뛰어나다.
- CRUD 작업에서 이진 데이터로 인한 오버헤드가 발생하지 않는다.
- 파일을 제 3자에게 공유하는 경우에 파일 시스템이 더 쉽다.

## 왜 데이터베이스에 저장해야하는가?

- 데이터베이스는 각 행에 ACID 규정을 제공한다.
- 데이터베이스는 파일과 메타데이터 간의 데이터 무결성을 제공한다.
- 데이터베이스 보안은 기본적으로 제공된다.
- 파일 삭제/업데이트가 항상 해당 행에 대한 작업과 동기화되므로 별도의 유지 관리가 필요하지 않다.
- 많은 수의 항목을 저장해야 하는 경우 데이터베이스 인덱스가 파일 시스템 트리보다 효율적일 수 있다.
- 데이터베이스 백업 시 해당 파일 데이터가 함께 포함되므로 별도의 유지 관리가 필요하지 않다.

## 그래서 어디에 저장할까?

결론적으로 프로젝트와 회사의 사정마다 다르다. 예를 들어 프로젝트 첫 시작 시 파일 수가 많지 않고 파일의 크기가 작다면, 데이터베이스에서 직접 관리하면서 비용을 줄일 수 있다. 하지만 처음부터 파일의 개수가 많거나 개별 파일의 크기가 크면 파일 시스템 기반 방식이 합리적이다.

그리고 데이터베이스에서 이진 데이터를 쿼리해오면 데이터 전체가 메모리에 로드되기 때문에 치명적일 수 있다. 그래서 정말 특별한 상황이 아니라면 파일 시스템을 사용하는 것이 일반적으로 정답이다.