ssl은 http 통신을 주고 받을때 내부 데이터를 암호화하여 공격자로부터 보호하는 방법이다.

ssl이 보안을 보장하는 방법은 두 가지 암호화 방식을 섞어서 사용하는 것이다. 암호화와 복호화를 같은 키로 수행하는 대칭키와 공개키로 잠근 것을 개인키로 풀 수 있는 비대칭키 방식을 혼합하여 사용한다.

보안 통로를 구축하기 위해 ssl 핸드쉐이크를 수행한다. 과정은 다음과 같다.

1. 사용자가 브라우저에 `https://...`와 같이 도메인을 입력하면 클라이언트는 먼저 서버에 연결을 요청한다. 이때 지원하는 암호화 방식 목록과 랜덤 데이터를 보낸다.
2. 서버는 사용자의 요청을 받으면, 암호화 방식을 선택하고 자신이 가진 ssl 인증서를 보낸다. 이 인증서 안에는 서버의 공개키가 포함된다. 참고로 이때 받은 인증서는 브라우저가 믿을 수 있는 기관에서 발급된 것인지 확인한다. 만약 인증되지 않은 인증서라면 경고창을 띄운다.
3. 인증서가 인증된 것이 확인되었다면, 사용자는 이후로 데이터를 주고받을 때 사용할 대칭키를 준비한다. 그리고 대칭키를 서버가 준 공개키로 암호화하여 서버로 보낸다.
4. 서버는 자신만이 가진 개인키로 사용자가 보낸 대칭키를 복호화하여 저장한다.
5. 이후로 사용자와 서버는 데이터를 주고 받을때 대칭키로 암호화 및 복호화를 진행한다.

위와 같은 구조로 데이터 보안을 보장하게 된다. 일반적으로 비대칭키 방식은 대칭키 방식에 비해 연산이 느리다. 이를 개선하기 위해 초기에 대칭키를 교환하는 상황에서만 비대칭키 방식을 사용해서 대칭키를 주고 받으며, 실제로 주고받는 데이터를 암호화 및 복호화하는 과정에서는 대칭키를 사용해서 빠른 복호화 연산 속도를 가지는 것이다.


## 대칭키의 수명

https의 경우 애플리케이션 계층이 아닌 전송 계층에 해당된다. 그렇기에 무상태성인 http를 따르지는 않는다. 전송 계층은 tls의 경우 유상태성 특징을 가지기 때문에 정해진 구성에 따라 상태를 유지한다. 대칭키의 수명은 다음 상황에 따라 결정된다.

1. TCP 연결이 유지되는 동안
    현대의 브라우저와 서버는 성능을 위해 `Connection: keep-alive` 헤더를 사용한다. 하나의 tcp 연결을 열어두고 여러 개의 http 요청을 처리하는데, 여기서 연결이 열려 있는 한 대칭키는 계속해서 살아있게 된다. 보통은 수 초에서 수 분으로 이루어진다.
2. 세션 재개
    사용자가 브라우저는 재시작하거나, 재접속해도 매번 핸드쉐이크를 하지 않는다. 보통 두 가지 방식으로 기존 대칭키를 재사용한다.

    session id: 서버 메모리에 세션 정보를 저장해두고 id만 클라이언트에게 전달한다.
    session ticket(rfc 5077): 서버가 세션 정보를 암호화해서 클라이언트에게 티켓 형태로 전달한다. 클라이언트는 다음 접속 때 해당 티켓을 전달하여 통신을 시작한다. 서버 설정에 따라 다르지만, 짧게는 수십 분에서 최대 몇 일까지 유지될 수 있다.
3. 강제 종료 및 만료
    브라우저 캐시가 삭제되거나 서버의 세션 저장소가 만료되면 키는 폐기될 수 있다. 또한 너무 긴 시간 연결이 유지될 경우, 중간에 키를 바꾸는 `rekeying` 과정을 거치기도 한다.
