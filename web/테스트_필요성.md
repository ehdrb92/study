테스트 코드는 왜 있어야하는가?

첫 번째 테스트를 수행하면 숨어 있는 버그를 사전에 발견하고 QA 프로세스를 진행하기 전에 미리 예방이 가능하다. 소프트웨어 개발에서 기획부터 출시까지의 단계가 있는데 버그 수정에 걸리는 시간은 뒤의 단계로 갈수록 어려워진다. 최대한 앞 단계에서 조기 발견을 하는 것이 좋다.

두 번째 유지보수가 간편해진다. 새로운 기능이나 기존 로직의 변경이 기존 코드에 영향을 미치지 않도록 보장하는데 도움을 준다.

세 번째 테스트 코드 그 자체로 대상 코드의 동작을 문서화하는 역할을 한다. 다른 개발자 혹은 비개발 팀원들은 테스트 대상 코드의 인풋과 아웃풋을 확인하면 코드 동작에 대한 정보를 얻을 수 있다.

네 번째 코드의 품질을 향상시킨다. 테스트 코드를 작성하다 보면 테스트하기 쉬운 구조로 테스트 대상 코드를 리팩터링하는 일이 빈번하게 일어난다. 이 과정에서 테스트 대상 코드의 구조가 개선된다.

마지막으로 자동화된 테스트는 반복적인 테스트 작업을 효과적으로 수행한다. 개발자가 코드 수정을 할 때마다 빠르게 검증을 할 수 있다.

## 테스트 더블

테스트 대상이 되는 코드는 외부의 구성 요소를 사용한다. 테스트 대상이 다른 모듈의 동작에 의존할 때는 그 의존성을 끊어 내야 한다. 이는 의존성 모의를 통해 해결한다.

실제 구성 요소나 모듈을 시뮬레이션 하는 객체를 **테스트 더블**이라고 한다. 테스트 더블에는 더미, 페이크, 스텁, 모의 객체, 스파이가 있다.

### 더미(dummy)

테스트 대상 클래스에 전달되지만 절대 사용되지 않는 객체를 말한다. 전달해야 하는 인수가 여러 개이지만 이들 중 몇 개만 수행할 수 있을 때 해볼 수 있다.

### 페이크(fake)

시뮬레이션하려는 대상과 함께 실제로 동작하는 구현체를 가진다. 하지만 보통 훨씬 단순한 방법으로 동작한다. 실제 데이터베이스 대신 배열 목록을 사용하는 페이크 데이터베이스를 사용할 수 있다.

### 스텁(stub)

테스트 과정에서 수행된 호출에 대해 하드 코딩된 응답을 제공한다. 페이크 객체와는 다르게 스텁은 실제로 동작하는 구현체가 없다. 스텁으로 된 함수는 하드 코딩된 데이터를 반환한다. 보통 가장 많이 사용된다.

### 모의 객체(mock)

응답을 설정한다는 점에서 스텁과 같은 역할을 한다. 하지만 모의 객체는 그 이상으로 모든 상호작용을 저장해 단언문에 활용할 수 있도록 해준다. 예를 들어 유저를 저장할 때 같은 이메일의 유저가 이미 존재하는지 확인하는 함수가 한 번 호출되었는지 단언할 수 있다. 스텁과 함께 많이 사용된다.

### 스파이(spy)

의존성 호출을 감시하고 기록한다. 하지만 그 기본 목적은 정보 수집이다. 주로 메서드 호출의 횟구, 전달된 매개변수, 호출 순서 등과 같은 행동에 대한 정보를 기록한다. 테스트 중에 상태나 행동을 확인할 수 있고 특별한 검증을 수행하기위해 사용되지만, 현업에서 잘 사용되지는 않는다.