웹 서비스를 이용하다 보면 사용자의 편의를 위해 로그인 상태를 오래동안 기억하여 특정 기기에서 로그아웃을 하지 않는한 인증된 상태를 유지하는 "자동 로그인"이 있다. 이는 어떻게 구현해야할까?

일반적으로 JWT 기반의 토큰 인증 방식을 많이 활용하다보니 이를 기준으로 알아보자.

크게 두 가지 접근법이 있다.

## Persistent Cookie

핵심적인 차이점은 쿠키의 종류이다.

- Session Cookie: 브라우저 종료 시 삭제 (일반 로그인)
- Persistent Cookie: `Expires` 또는 `Max-Age`를 명시해 브라우저를 닫아도 유지 (자동 로그인)

JWT를 사용한다면, 리프레시 토큰을 Persistent Cookie에 담아 장기간 유지하는 방식이다.

## DB 기반 Remember-Me Token (보안상 권장)

가장 널리 쓰이는 방식으로 Charles Miller의 "Persistent Login Cookie Best Practice"가 있다. 사용자가 자동로그인을 선택하면, 일반 세션 쿠키와 함께 별도의 로그인 쿠키를 발급하는데, 이 쿠키는 사용자 이름과 암호화된 충분히 큰 난수 토큰을 가지며 DB에도 함께 저장된다.

더 안전한 개선된 방식은 `{ 사용자명, 식별자(series), 토큰 }` 세 가지 쌍을 사용하는 것으로, 방문 시마다 토큰을 교체 발급하고, 만약 유효한 식별자에 토큰이 불일치하면 쿠키 도난으로 간주하여 해당 사용자의 모든 자동 로그인 세션을 폐기한다.

```
데이터베이스 테이블 예시:
persistent_logins (
  username   VARCHAR,
  series     VARCHAR  PRIMARY KEY,  -- 기기/세션 식별자 (변하지 않음)
  token      VARCHAR,               -- 방문마다 새로 교체
  last_used  TIMESTAMP
)
```
